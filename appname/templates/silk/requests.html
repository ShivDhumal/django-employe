{% extends 'silk/base/root_base.html' %}
{% load silk_inclusion %}
{% load static %}

{% block pagetitle %}Silky - Requests{% endblock %}

{% block style %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'silk/css/pages/requests.css' %}" />
{% endblock %}

{% block js %}
    {{ block.super }}
    <script src="{% static 'silk/js/pages/requests.js' %}"></script>
{% endblock %}

{% block menu %}
    {% root_menu request %}
{% endblock %}

{% block filter %}
<form id="filter-form" action="." method="get" class="filter-form">
    <!-- View Style -->
    <div class="filter-item">
        <label>View:</label>
        <select name="view_style" onchange="this.form.submit();">
            {% for option in options_view_style %}
                <option value="{{ option.value }}" {% if option.value == view_style %}selected{% endif %}>
                    {{ option.label }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Show -->
    <div class="filter-item">
        <label>Show:</label>
        <select name="show" onchange="this.form.submit();">
            {% for option in options_show %}
                <option value="{{ option }}" {% if option == show %}selected{% endif %}>
                    {{ option }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Order By -->
    <div class="filter-item">
        <label>Order:</label>
        <select name="order_by" onchange="this.form.submit();">
            {% for option in options_order_by %}
                <option value="{{ option.value }}" {% if option.value == order_by %}selected{% endif %}>
                    {{ option.label }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Order Direction -->
    <div class="filter-item">
        <label>Direction:</label>
        <select name="order_dir" onchange="this.form.submit();">
            {% for option in options_order_dir %}
                <option value="{{ option.value }}" {% if option.value == order_dir %}selected{% endif %}>
                    {{ option.label }}
                </option>
            {% endfor %}
        </select>
    </div>
</form>
{% endblock %}

{% block filters %}
<h4>Request</h4>
<div class="filter-section">
    <!-- Overall Time -->
    <label>Took longer than:</label>
    <input type="text" name="filter-overalltime-value" placeholder="milliseconds" value="{{ filters.overalltime.value }}" />

    <!-- Number of Queries -->
    <label>Executed more than:</label>
    <input type="text" name="filter-numqueriesfilter-value" placeholder="n" value="{{ filters.numqueriesfilter.value }}" />

    <!-- Time Spent -->
    <label>Spent longer than:</label>
    <input type="text" name="filter-timespentfilter-value" placeholder="milliseconds" value="{{ filters.timespentfilter.value }}" />
</div>

<h4>Date Range</h4>
<div class="filter-section">
    <!-- Seconds Ago -->
    <label>Executed:</label>
    <input type="text" name="filter-seconds-value" placeholder="seconds" value="{{ filters.seconds.value }}" />

    <!-- Before Date -->
    <label>Before:</label>
    <input type="text" class="datetimepicker" name="filter-beforedate-value" placeholder="date" value="{{ filters.beforedate.value }}" />

    <!-- After Date -->
    <label>After:</label>
    <input type="text" class="datetimepicker" name="filter-afterdate-value" placeholder="date" value="{{ filters.afterdate.value }}" />
</div>

<h4>View</h4>
<div class="filter-section">
    <!-- View Name -->
    <label>View:</label>
    <select name="filter-viewname-value">
        <option value="" {% if not filters.viewname.value %}selected{% endif %}></option>
        {% for view_name in view_names %}
            <option value="{{ view_name }}" {% if view_name == filters.viewname.value %}selected{% endif %}>
                {{ view_name }}
            </option>
        {% endfor %}
    </select>

    <!-- Path -->
    <label>Path:</label>
    <select name="filter-path-value">
        <option value="" {% if not filters.path.value %}selected{% endif %}></option>
        {% for path in options_paths %}
            <option value="{{ path }}" {% if path == filters.path.value %}selected{% endif %}>
                {{ path }}
            </option>
        {% endfor %}
    </select>

    <!-- Status Code -->
    <label>Status Code:</label>
    <select name="filter-status_code-value">
        <option value="" {% if not filters.status_code.value %}selected{% endif %}></option>
        {% for status_code in options_status_codes %}
            <option value="{{ status_code }}" {% if status_code == filters.status_code.value %}selected{% endif %}>
                {{ status_code }}
            </option>
        {% endfor %}
    </select>

    <!-- Method -->
    <label>Method:</label>
    <select name="filter-method-value">
        <option value="" {% if not filters.method.value %}selected{% endif %}></option>
        {% for method in options_methods %}
            <option value="{{ method }}" {% if method == filters.method.value %}selected{% endif %}>
                {{ method }}
            </option>
        {% endfor %}
    </select>
</div>
{% endblock %}

{% block data %}
{% if results %}
    <div class="results">
        {% for silk_request in results %}
            <a href="{% url 'silk:request_detail' request_id=silk_request.pk %}" class="request-item">
                {% request_summary silk_request %}
            </a>
        {% endfor %}
    </div>
{% else %}
    <div class="empty">
        <h2>No matches found</h2>
        <p>No requests were found with the current set of filters. Please adjust your filters and try again.</p>
    </div>
{% endif %}
{% endblock %}
